---
import { getCollection } from 'astro:content';
import Button from '@components/Button.astro';
import Card from '@components/Card.astro';
import EventsList from '@components/events/EventsList.astro';
import Icon from '@components/Icon.astro';
import Hero from '@components/layout/Hero.astro';
import BlockLink from '@components/link/BlockLink.astro';
import Link from '@components/link/Link.astro';
import NewsList from '@components/news/NewsList.astro';
import Testimonial from '@components/Testimonial.astro';
import YouTubeEmbed from '@components/YouTubeEmbed.astro';
import programs from '@content/programs.json';
import Base from '@layouts/Base.astro';
import { slugify } from '../util/slugify';

// fetch and sort recent news & events
const news = (await getCollection('news'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 2);
const events = (await getCollection('events'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 2);

// find latest publication
const publications = (await getCollection('publications')).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);
const latestPublication = publications[0].data;

// select random programs
const randomPrograms = programs.sort(() => 0.5 - Math.random()).slice(0, 3);
---

<Base title="BioData Catalyst">
  <Hero
    image="https://picsum.photos/1600"
    title="Keeping data and analysis safe and secure"
    text="NHLBI BioData Catalyst® (BDC) is a cloud-based ecosystem that offers Researchers data, analytic tools, applications, and workflows in secure workspaces"
  />
  <div class="grid-container">
    <Card mediaPosition="left">
      <div slot="content">
        <h2 class="margin-0">What is BDC?</h2>
        <p>
          It is a <strong>community</strong> where researchers can find, access, store,
          share, and analyze heart, lung, blood, and sleep data resources.

          And it is one of NHLBI's data repositories, <strong>where researchers
          share</strong> scientific data from NHLBI-funded research so they and others can
          <strong>reproduce findings and reuse data</strong> to advance science.

          By increasing access to NHLBI data and innovative analytic capabilities,
          <strong>BDC accelerates reproducible biomedical research</strong> to drive
          scientific advances that can help prevent, diagnose, and treat heart, lung,
          blood, and sleep disorders.
        </p>
      </div>

      <div slot="media">
        <YouTubeEmbed id="enWIpA0aJb4" title="What is BioData Catalyst?" />
      </div>
    </Card>

    <section>
      <h2 style={{ textAlign: 'center' }}>Get Started</h2>
      <div class="grid-container padding-0">
        <div class="grid-row">
          <div class="tablet:grid-col-3 mobile-lg:grid-col-6 display-flex flex-justify-center flex-align-center padding-y-2">
            <Link to="/use-bdc/explore"><Button size="big" icon="search">Explore</Button></Link>
          </div>
          <div class="tablet:grid-col-3 mobile-lg:grid-col-6 display-flex flex-justify-center flex-align-center padding-y-2">
            <Link to="/use-bdc/analyze"><Button size="big" icon="assessment">Analyze</Button></Link>
          </div>
          <div class="tablet:grid-col-3 mobile-lg:grid-col-6 display-flex flex-justify-center flex-align-center padding-y-2">
            <Link to="/use-bdc/share"><Button size="big" icon="share">Share</Button></Link>
          </div>
          <div class="tablet:grid-col-3 mobile-lg:grid-col-6 display-flex flex-justify-center flex-align-center padding-y-2">
            <Link to="/use-bdc/explore#check-access"><Button size="big" icon="verified_user">Check Access</Button></Link>
          </div>
        </div>
      </div>
    </section>

    <section class="margin-y-10">
      Data on BDC?
    </section>

    <section class="margin-y-10">
      <h2>Featured Datasets</h2>
      <div class="grid-container padding-0">
        <div class="grid-row grid-gap">
          {
            randomPrograms.map((study) => (
              <div class="flex-center tablet:grid-col">
                <div class="border border-base-lighter radius-lg display-flex flex-column padding-2">
                  <Link to={ `/about/studies/${ slugify(study.key) }` }>{study.key}</Link>
                  <p>
                    Culpa est consequat reprehenderit commodo ut aliquip aliqua sed anim dolor occaecat in enim quis et.
                    In enim minim veniam id irure culpa adipisicing sed aute sed.
                  </p>
                </div>
              </div>
            ))
          }
        </div>
      </div>
      <BlockLink to="#" flex="end">View all Datasets</BlockLink>
    </section>

    <Card mediaPosition="right">
      <div slot="content">
        <h2>New Published Research</h2>
        <Link to={latestPublication.url}>
          {latestPublication.title}
        </Link>
        <ul class="usa-list usa-list--unstyled font-body-3xs">
          <li>Published on {
            latestPublication.date.toLocaleDateString(
              'en-US',
              { year: 'numeric', month: 'long', day: 'numeric' },
          )}</li>
          <li>Published in <em>{latestPublication.location}</em></li>
        </ul>
        <BlockLink to="/updates/publications">View all published research</BlockLink>
      </div>

      <div slot="media">
        <img src="https://picsum.photos/800/500" class="radius-lg" />
      </div>
    </Card>

    <section class="margin-y-10">
      <div class="grid-container padding-0">
        <div class="grid-row grid-gap">
          <div class="tablet:grid-col">
            <h2>What's new in BDC?</h2>
            <NewsList items={news} />
          </div>
          <div class="tablet:grid-col">
            <h2>Events</h2>
            <EventsList items={events} />
          </div>
        </div>
        <div class="grid-row grid-gap">
          <div class="tablet:grid-col">
            <BlockLink to="/news" flex="end">View all News</BlockLink>
          </div>
          <div class="tablet:grid-col">
            <BlockLink to="/events" flex="end">View all Events</BlockLink>
          </div>
      </div>
    </section>

    <section class="margin-y-10">
      <h2 style={{ textAlign: 'center' }}>
        What BDC Investigators are working on
      </h2>
      <div class="grid-container padding-0 margin-top-8">
        <div class="grid-row grid-gap-md">
          <div class="tablet:grid-col-4">
            <Testimonial
              quote="I used DESeq2 for RNA-seq differential expression analysis and found significant gene expression changes after adjusting for batch effects. The results offered clear biological insight and strong validation. "
              attribution='John K.'
            />
          </div>
          <div class="tablet:grid-col-4">
            <Testimonial
              quote="I used the STAAR Pipeline for RNA-seq data and found novel gene-trait associations that validated our hypotheses. It made the analysis both efficient and reproducible."
              attribution='Casey G.'
            />
          </div>
          <div class="tablet:grid-col-4">
            <Testimonial
              quote="I used the STAAR Pipeline for genomic data analysis and found significant associations that I couldn’t detect before. It streamlined my workflow and gave me results I could trust."
              attribution='Casey G.'
            />
          </div>
        </div>
      </div>
      <BlockLink to="#" flex="end">Learn how researchers are using BDC</BlockLink>
    </section>

  </div>
</Base>
